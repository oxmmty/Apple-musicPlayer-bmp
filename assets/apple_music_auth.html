<!DOCTYPE html>
<html>

<head>
    <title>Apple Music Authentication</title>
    <script src="https://js-cdn.music.apple.com/musickit/v1/musickit.js"></script>
    <style>
        #apple-music-login {
            font-size: 16px;
            /* Adjust the font size as needed */
            padding: 10px 20px;
            /* Adjust the padding as needed */
        }
    </style>
    <script>
        document.addEventListener('musickitloaded', function () {
            fetch('https://music-app-9ee48.cloudfunctions.net/api/get-developer-token')
                .then(response => response.json())
                .then(data => {
                    MusicKit.configure({
                        developerToken: data.token,
                        app: {
                            name: '音楽ペースメーカー',
                            build: '1.0.0'
                        }
                    });
                    const music = MusicKit.getInstance();
                    document.getElementById('apple-music-login').addEventListener('click', function () {
                        music.authorize().then(musicUserToken => {
                            fetch('https://music-app-9ee48.cloudfunctions.net/api/store-music-user-token', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ token: musicUserToken })
                            }).then(() => {
                                window.location.href = `music-auth-success://${musicUserToken}`;
                            });
                        }).catch(error => {
                            console.error('Error during authorization:', error);
                            window.location.href = `music-auth-failure://${error}`;
                        });
                    });
                });
        });
    </script>
</head>

<body>
    <button id="apple-music-login">Log in with Apple Music</button>
</body>

</html>